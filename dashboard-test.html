<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sultanate of Oman – Check-In Dashboard</title>
  <style>
    :root{
      --brand:#006400;
      --bg:#f4f4f4;
      --card:#fff;
      --text:#1f2933;
      --muted:#6b7280;
      --radius:18px;
      --shadow:0 10px 28px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:clamp(14px,3vw,30px);
    }
    .wrap{
      width:min(100%, 960px);
    }
    header{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px 18px 20px;
      border-top:6px solid var(--brand);
      text-align:left;
      margin-bottom:18px;
      display:flex;
      align-items:center;
      gap:14px;
    }
    header img{
      height:40px;
      border-radius:6px;
      object-fit:cover;
    }
    header h1{
      margin:0;
      font-size:clamp(18px,3.2vw,24px);
      color:var(--brand);
    }
    header p{
      margin:2px 0 0;
      color:var(--muted);
      font-weight:500;
    }
    .cards{
      display:grid;
      gap:16px;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px 16px 18px;
      position:relative;
      overflow:hidden;
      min-height:130px;
    }
    .label{
      font-size:.8rem;
      text-transform:uppercase;
      letter-spacing:.06em;
      color:var(--muted);
      margin-bottom:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .value{
      font-size:2.5rem;
      font-weight:700;
      color:var(--text);
      line-height:1.05;
    }
    .badge{
      background:rgba(0,100,0,.1);
      color:var(--brand);
      padding:2px 10px;
      border-radius:999px;
      font-size:.7rem;
    }
    .footer-note{
      margin-top:14px;
      text-align:center;
      color:var(--muted);
      font-size:.7rem;
    }
    .pulse{
      position:absolute;
      top:-40px;
      right:-40px;
      width:120px;
      height:120px;
      background:rgba(0,100,0,.07);
      border-radius:50%;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="https://www.fm.gov.om/wp-content/uploads/Flag_of_OmanMin-of-Info-800px-600x343.jpg" alt="Flag of Oman">
      <div>
        <h1>National Day 2025 – Check-In Dashboard</h1>
        <p>Real-time counters (auto-refresh every 5s)</p>
      </div>
    </header>

    <section class="cards" aria-label="Check-in stats">
      <article class="card" aria-label="Checked in guests">
        <div class="pulse"></div>
        <div class="label">
          <span>Checked In</span>
          <span class="badge" id="updated-checked">—</span>
        </div>
        <div class="value" id="checked">—</div>
      </article>

      <article class="card" aria-label="Not checked in guests">
        <div class="pulse"></div>
        <div class="label">
          <span>Not Checked In</span>
          <span class="badge" id="updated-not">—</span>
        </div>
        <div class="value" id="notChecked">—</div>
      </article>

      <article class="card" aria-label="Total guests">
        <div class="pulse"></div>
        <div class="label">
          <span>Total Guests</span>
          <span class="badge" id="updated-total">—</span>
        </div>
        <div class="value" id="total">—</div>
      </article>
    </section>

    <p class="footer-note" id="lastFetch">Waiting for data…</p>
  </div>

  <script>
    // use GitHub API to bypass raw.githubusercontent caching
    const API_URL = "https://api.github.com/repos/oman-checkin/oman-checkin/contents/checkin.json";

    async function loadCounters() {
      try {
        const res = await fetch(API_URL + "?t=" + Date.now(), {
          headers: { "Accept": "application/vnd.github.v3+json" }
        });
        if (!res.ok) throw new Error("Fetch failed: " + res.status);
        const file = await res.json();
        const decoded = atob(file.content);
        const data = JSON.parse(decoded);

        const checked = data.checked_in ?? 0;
        const notChecked = data.not_checked_in ?? 0;
        const total = data.total ?? (checked + notChecked);

        document.getElementById("checked").textContent = checked;
        document.getElementById("notChecked").textContent = notChecked;
        document.getElementById("total").textContent = total;

        const ts = new Date().toLocaleTimeString();
        document.getElementById("updated-checked").textContent = "OK";
        document.getElementById("updated-not").textContent = "OK";
        document.getElementById("updated-total").textContent = "OK";
        document.getElementById("lastFetch").textContent = "Last update: " + ts;
      } catch (err) {
        document.getElementById("lastFetch").textContent = "Error loading data";
      }
    }

    // first load
    loadCounters();
    // auto refresh every 10 seconds
    setInterval(loadCounters, 10000);
  </script>
</body>
</html>
